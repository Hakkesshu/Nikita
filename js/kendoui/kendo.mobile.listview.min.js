/*
* Kendo UI Complete v2012.1.423 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at http://kendoui.com/complete-license
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
(function(a,b){function y(b,c){c=a(c);if(!!c.children("input[type=checkbox],input[type=radio]").length){var d=c.parent();if(d.contents().not(c).not(function(){return this.nodeType==3})[0])return;c.addClass("km-listview-label")}}function x(b,d){d=a(d);var e=d.parent(),f=d.add(e.children("[data-"+c.ns+"role=detailbutton]"));if(!e.contents().not(f)[0]){var g=e.data(c.ns+"icon"),h=a('<span class="km-icon"/>');d.addClass("km-listview-link").attr(c.attr("role"),"listview-link"),g&&(d.prepend(h),h.addClass("km-"+g))}}function w(b){if(!(b.which>1)){var d=a(b.currentTarget),e=d.parent(),f=d.data(c.ns+"role")||"",g=!f.match(/button/),h=b.originalEvent&&b.originalEvent.defaultPrevented;g&&e.toggleClass("km-state-active",b.type===q&&!h);if(d.is("label")&&b.type===t&&!h){var i=d.find("input"),j=i.attr("type"),k=!i[0].checked;j==="radio"&&(k=!0),i[0].checked=k}}}var c=window.kendo,d=c.mobile.ui,e=c.support,f=c.data.DataSource,g=d.Widget,h=".km-list > li",i=".km-list > li > .km-listview-link, .km-list > li > .km-listview-label",j=".km-list > li > .km-listview-label > input",k=a.proxy,l="km-group-title",m='<div class="'+l+'"><span class="km-text"></span></div>',n=c.template('<li><div class="'+l+'">#= this.headerTemplate(data) #</div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),o='<div class="km-listview-wrapper" />',p="function",q=e.mousedown,r=e.mousemove,s=e.mousecancel,t=e.mouseup,u="click",v="requestStart",z=g.extend({init:function(a,b){var e=this;g.fn.init.call(e,a,b),b=e.options,e.element.on([q,t,r,s].join(" "),i,w).on("click",j,function(a){a.preventDefault()}).on(t,h,k(e._click,e)),e.element.wrap(o),e.wrapper=e.element.parent(),e._loadMore(),e._dataSource(),b.dataSource?e.dataSource.fetch():e._style(),c.notify(e,d)},events:[u],options:{name:"ListView",type:"flat",template:"${data}",loadMore:!1,loadMoreText:"Press to load more",pullToRefresh:!1,appendOnRefresh:!1,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing",headerTemplate:'<span class="km-text">${value}</span>',pullOffset:140,style:""},setOptions:function(a){g.fn.setOptions.call(this,a)},setDataSource:function(a){this.options.dataSource=a,this._dataSource(),a.fetch()},_dataSource:function(){var a=this,b=a.options;a.dataSource&&a._refreshHandler?a.dataSource.unbind("change",a._refreshHandler).unbind(v,a._showLoadingProxy):a._refreshHandler=k(a.refresh,a),a.dataSource=f.create(b.dataSource).bind("change",a._refreshHandler),a._showLoadingProxy&&!b.pullToRefresh&&!b.loadMore&&a.dataSource.bind(v,a._showLoadingProxy)},viewInit:function(a){var b=this,c=b.options,d=b.dataSource,e=a.application;b.scroller=a.scroller,b._hideLoadingProxy=k(e.hideLoading,e),b._showLoadingProxy=k(e.showLoading,e),!c.pullToRefresh&&!c.loadMore&&d.bind(v,b._showLoadingProxy),c.pullToRefresh&&b.scroller.setOptions({pullToRefresh:!0,pull:function(){d.read()},pullTemplate:c.pullTemplate,releaseTemplate:c.releaseTemplate,refreshTemplate:c.refreshTemplate})},refresh:function(b){b=b||{};var e=this,f=e.element,g=e.options,h=e.dataSource,i=h.view(),j="html",k,l,m;b.action==="itemchange"?(l=b.items[0],m=a(e.template(l)),f.find("[data-"+c.ns+"uid="+l.uid+"]").replaceWith(m),e.trigger("itemChange",{item:m,data:l,ns:d})):(e._templates(),e.trigger("dataBinding"),h.group()[0]?(g.type="group",k=c.render(e.groupTemplate,i)):k=c.render(e.template,i),g.loadMore&&!e._loadButton.is(":visible")?(j="append",e._toggleButton(!0)):g.appendOnRefresh&&(j="prepend"),f[j](k),e.options.pullToRefresh&&e.scroller.pullHandled(),c.mobile.init(f.children()),e._hideLoadingProxy&&e._hideLoadingProxy(),e._style(),e.trigger("dataBound",{ns:d}))},_templates:function(){var b=this,d=b.options.template,e=b.options.headerTemplate,f="",g={},h={};if(b.dataSource.group()[0]||b.dataSource.view()[0]instanceof c.data.ObservableObject)f=' data-uid="#=uid#"';typeof d===p&&(g.template=d,d="#=this.template(data)#"),h.template=b.template=a.proxy(c.template("<li"+f+">"+d+"</li>"),g),typeof e===p&&(h._headerTemplate=e,e="#=this._headerTemplate(data)#"),h.headerTemplate=c.template(e),b.groupTemplate=a.proxy(n,h)},_click:function(b){if(!(b.which>1||b.originalEvent&&b.originalEvent.defaultPrevented)){var d=this,e,f=a(b.currentTarget),g=a(b.target),h=g.closest("["+c.attr("name")+"]",f),i=f.attr(c.attr("uid"));i&&(e=d.dataSource.getByUid(i)),d.trigger(u,{target:g,item:f,dataItem:e,button:h.data("kendoMobileButton")})&&b.preventDefault()}},items:function(){return this.options.type==="group"?this.element.find(".km-list").children():this.element.children()},_style:function(){var b=this,c=b.options,d=c.type==="group",e=b.element,f=c.style==="inset";e.addClass("km-listview").toggleClass("km-list",!d).toggleClass("km-listinset",!d&&f).toggleClass("km-listgroup",d&&!f).toggleClass("km-listgroupinset",d&&f),d&&(e.children().children("ul").addClass("km-list"),e.find(">li").each(function(){var b=a(this).contents().first();!b.is("ul")&&!b.is("div."+l)&&b.wrap(m)})),b.items().find(">a").each(x),b.items().find(">label").each(y),e.closest(".km-content").toggleClass("km-insetcontent",f)},_loadMore:function(){var a=this,b=a.wrapper,c=a.options;c.loadMore&&(b.append('<span class="km-load-more"><span style="display:none" class="km-icon"></span><button class="km-load km-button">'+c.loadMoreText+"</button></span>"),a._loadButton=b.children(".km-load-more").children(".km-load").click(function(){a._toggleButton(!1),a.dataSource.next()}),a._loadIcon=a._loadButton.prev())},_toggleButton:function(a){var b=this._loadIcon;this._loadButton.toggle(a),a?b.hide():b.css("display","block")}});d.plugin(z)})(jQuery)